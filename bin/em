#!/bin/bash
# em - Open a directory as a projectile project in Emacs
# Usage: em [directory]
# If no directory is given, uses the current directory.

DIR="${1:-.}"
DIR="$(cd "$DIR" 2>/dev/null && pwd)" || { echo "Directory not found: $1"; exit 1; }

# Check if emacs server is running
if emacsclient -e "t" >/dev/null 2>&1; then
    # Server is running
    emacsclient -n -e "(progn
      (require 'projectile)
      (let ((dir \"$DIR/\"))
        (unless (member dir projectile-known-projects)
          (projectile-add-known-project dir))
        (projectile-switch-project-by-name dir))
      (raise-frame))"
else
    # No server running, start emacs
    emacs --eval "(progn
      (require 'projectile)
      (let ((dir \"$DIR/\"))
        (unless (member dir projectile-known-projects)
          (projectile-add-known-project dir))
        (projectile-switch-project-by-name dir)))" &
    disown
fi
